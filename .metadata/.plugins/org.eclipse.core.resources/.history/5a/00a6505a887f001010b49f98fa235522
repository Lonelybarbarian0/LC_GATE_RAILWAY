/*
 * CDH.c
 *
 *  Created on: Aug 22, 2025
 *      Author: kailas
 */

#include "CDH.h"

uint8_t CDC_TX_MSG [10] = {0xFF};
uint8_t CDC_RX_MSG [5]  = {0xFF};
uint8_t buff_status[2] = {0x00}; //buff_status[0] - For lock , buff_status[1] - For Alarm

void Train_status_update();
void Boom_status_update()
{
	/* BOOM1 UP/DOWN - Status */

	if( (HAL_GPIO_ReadPin(BOOM1_LS1_GPIO_Port, BOOM1_LS1_Pin) == GPIO_PIN_SET) &&
	    (HAL_GPIO_ReadPin(BOOM1_LS2_GPIO_Port, BOOM1_LS2_Pin) == GPIO_PIN_SET) )
	{
		CDC_TX_MSG[4] = 0x01; /* BOOM UP */
	}

	else if ((HAL_GPIO_ReadPin(BOOM1_LS1_GPIO_Port, BOOM1_LS1_Pin) == GPIO_PIN_RESET) &&
		    (HAL_GPIO_ReadPin(BOOM1_LS2_GPIO_Port, BOOM1_LS2_Pin) == GPIO_PIN_RESET) )
	{
		CDC_TX_MSG[4] = 0x00; /* BOOM DOWN */
	}
	else CDC_TX_MSG[4] = 0xFF; /* ERROR */
}

void Lock_status_update();
void Alarm_status_update();

void Trigger_lock()
{
	/* To Lock/Unlock the lever */

	if(buff_status[0] == 0x01) /* Lock */
	{
		HAL_GPIO_WritePin(Lever_Lock_GPIO_Port, Lever_Lock_GPIO_Pin, GPIO_PIN_SET);
	}
	else if(buff_status[0] == 0x00) /* UNLOCK */
	{
		HAL_GPIO_WritePin(Lever_Lock_GPIO_Port, Lever_Lock_GPIO_Pin, GPIO_PIN_RESET);
	}
}
void Trigger_alarm();
void Send_data();

void Transmit_Data_Handler();
void Receive_Data_Handler();

void Transmit_CDC();
void Receive_CDC();

